<!doctype html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="style.css" />
	<link rel="stylesheet" media="all and (max-width:1000px) and (orientation:landscape)" href="style-mobile.css" />
	<meta content="width=device-width, initial-scale=1" name="viewport" />
	<title>FetishQuest</title>
	<meta name="description" content="A lewd dungeon game!">
	<meta name="author" content="JasX">
	<link rel="manifest" href="/manifest.webmanifest" />
	<link rel="icon" type="image/png" href="media/ui/logo_64.png" />
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">

</head>

<body>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/17.2.0/Tween.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/dexie/2.0.4/dexie.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.1.1/math.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script src="globalFunctions.js"></script>
	<script>
		console.debug("Entry point for debugging is 'game'");
		// Globals
		var game = true, glib, g_Condition, g_GameEvent, g_Audio, g_Mod, g_Comparer, g_Collection, g_Generic, g_Asset, g_Text, g_Calculator, g_GameAction;
	</script>
	<script type="module">
		import Game from './classes/Game.js';
		import Player from './classes/Player.js';
		import Condition from './classes/Condition.js';
		import GameEvent from './classes/GameEvent.js';
		import Audio from './classes/Audio.js';
		import Mod from './classes/Mod.js';
		import GameLib from './classes/GameLib.js';
		import Comparer from './classes/Comparer.js';
		import Collection from './classes/helpers/Collection.js';
		import Generic from './classes/helpers/Generic.js';
		import Asset from './classes/Asset.js';
		import Text from './classes/Text.js';
		import Calculator from './classes/Calculator.js';
		import GameAction from './classes/GameAction.js';
		console.debug("Modules imported, starting game");
		
		g_Condition = Condition;
		g_GameEvent = GameEvent;
		g_Audio = Audio;
		g_Mod = Mod;
		g_Comparer = Comparer;
		g_Collection = Collection;
		g_Generic = Generic;
		g_Asset = Asset;
		g_Text = Text;
		g_Calculator = Calculator;
		g_GameAction = GameAction;
		glib = new GameLib();
		window.Player = Player;

		if( 'serviceWorker' in navigator ){

			console.log("Waiting for window load");
			window.addEventListener('load', function() {
				console.log("Loading serviceworker");
				navigator.serviceWorker.register('/serviceworker.js').then(function(registration) {
					// Registration was successful
					console.log('ServiceWorker registration successful with scope: ', registration.scope);
				}, function(err) {
					// registration failed :(
					console.log('ServiceWorker registration failed: ', err);
				});
			});

		}

		glib.ini()
		.then(() => {
			Game.load();
		})
		.then(() => {
			console.debug("Game initialized. Globals:\ngame = Active game\nglib = Game asset library\ng_Condition = Condition class\ng_Mod = Mod class\ng_GameEvent = GameEvent class\ng_Audio = Audio class");
		})
		.catch(err => console.error(err));
		
	</script>
	<div id="bg"></div>

	<div id="content">
		<div id="renderer"></div>
		<div id="loading_screen" class="hidden">
			<div class="loadingBar">
				<div class="slider"></div>
			</div>
			<p>LOADING <span class="loadState">(?/?)</span></p>
		</div>
		<div id="mapChat"></div>
		<div id="ui">
			<div class="middle">
				<div class="content"></div>
				<div class="chat" contenteditable></div>
			</div>
			<div class="yourTurnBadge hidden">
				Your Turn
				<span class="timeLeft"></span>
			</div>
			
			<div class="players">
				<div class="left"></div>
				<div class="right"></div>
			</div>

			<div class="actionbar">
				<div class="resources">
					<div class="stat ap"></div>
					<div class="stat mp"></div>
				</div>
				<div class="actions"></div>
			</div>
			<div id="multiCastPicker" class="hidden"></div>
		</div>
		<div id="yourTurnBorder" class="hidden"></div>
		
		<div id="fx"></div>
		
		<div id="gameIcons"></div>
	</div>

	<!-- Floating combat text -->
	<div id="fct"></div>
	
	<div id="roleplay" class="hidden">
		<div class="left">
			<div class="portrait bg"></div>
		</div>
		<div class="right">
			<div class="text bg"></div>
			<div class="responses"></div>
		</div>
	</div>

	<div id="modal" class="hidden">
		<div class="wrapper">
			<div class="content"></div>
			<input type="button" value="Close" />
		</div>
	</div>

	<div id="customModals" class="hidden">
		<div id="sleepSelect" class="bgMarble">
			<img class="bedIcon" src="media/wrapper_icons/bed.svg" />
			<span class="title">How long would you like to sleep?</span><br />
			<input type="range" min=1 max=24 value=1 /><br />
			<input type="button" class="sleep" value="Sleep 1 Hour &#129130; 10 PM" />
			<input type="button" class="cancel" value="Cancel" />
		</div>
	</div>

	<div id="questAccept" class="hidden">
		<h3 class="title">Quest Accepted:</h3>
		<h1 class="questName">Name here</h1>
	</div>

	<div id="selectionbox" class="selectionbox hidden"></div>

	<div id="notices"></div>

	<div id="mainMenuToggle">
		<div class="button" data-id="map" style="background-image:url(/media/wrapper_icons/treasure-map.svg);"></div>
		<div class="button mainMenuToggle" data-id="toggle" style="background-image:url(/media/ui/logo_128.png); background-size: 130% 130%; background-position:center;"></div>
	</div>

	<div id="tooltip" class="hidden"></div>
	
	<div id="blackScreen"></div>

</body>
</html>